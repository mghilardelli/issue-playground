name: Update Issue Checkbox

on:
  issues:
    types: [ edited ]

permissions:
  issues: write

jobs:
  update-checkbox:
    runs-on: ubuntu-latest
    steps:
      - name: Checkboxes
        uses: actions/github-script@v6
        with:
          script: |
            const checkboxes = ["BA", "UX", "DEV"];
            const issueBody= context.payload.issue.body
            const oldIssueBody = context.payload.changes.body.from
            const username = context.actor;
            for(const checkbox of checkboxes){
              if(issueBody.includes(`- [x] ${checkbox}`) && oldIssueBody.includes(`- [ ] ${checkbox}`)){
                console.log(`${checkbox} is checked`)
                const updatedBody = issueBody.replace(`- [x] ${checkbox}`, `- [x] ${checkbox} (@${username})`);
                github.rest.issues.update({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.issue.number,
                  body: updatedBody
                });
              } else if(issueBody.includes(`- [ ] ${checkbox}`) && oldIssueBody.includes(`- [x] ${checkbox}`)){
                console.log(`${checkbox} is unchecked`)
                const updatedBody = issueBody.replace(regex, `- [ ] ${checkbox}`);
                console.log(updatedBody)
              }
            }
